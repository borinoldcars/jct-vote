<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>JCT 2026 – Véhicule A001</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#f4f4f4; margin:0; }
    .container { max-width:720px; margin:auto; padding:20px; }
    .card { background:#fff; border-radius:16px; padding:20px; box-shadow:0 8px 20px rgba(0,0,0,.08); }
    button { background:#111; color:#fff; border:none; padding:14px 18px; border-radius:12px; font-size:16px; cursor:pointer; }
    button:disabled { opacity:.5; cursor:not-allowed; }
    .message { margin-top:15px; font-size:14px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Véhicule A001</h1>
      <p><strong>Jurbise Classic Tour 2026</strong></p>

      <p>Description du véhicule…</p>

      <button id="voteBtn" type="button">Je vote pour ce véhicule</button>
      <div class="message" id="msg"></div>
    </div>
  </div>

<script>
const VEHICLE_ID = "A001";
const API_URL = "https://script.google.com/macros/s/AKfycbyowXHPBAkS6LhG17Tb8EW_R8K3T1OnIWzQPZ1iaoXHvQAMbXqi_APLnbg-oyTQOlsd/exec";

<script>
const VOTE_SESSION = "JCT2026_01"; // ← change ce code quand tu veux relancer un vote

function getDeviceId() {
  let id = localStorage.getItem("jct_device_id_" + VOTE_SESSION);
  if (!id) {
    id = "dev_" + Math.random().toString(36).slice(2, 12);
    localStorage.setItem("jct_device_id_" + VOTE_SESSION, id);
  }
  return id;
}
</script>


document.getElementById("voteBtn").addEventListener("click", vote);

function vote() {
  const btn = document.getElementById("voteBtn");
  const msg = document.getElementById("msg");

  msg.textContent = "Vote en cours…";
  btn.disabled = true;

  const device = encodeURIComponent(getDeviceId());
  const callbackName = "cb_" + Math.random().toString(36).slice(2, 10);

  window[callbackName] = function(res) {
    if (res && res.ok) {
      msg.textContent = "✅ Merci, votre vote est enregistré !";
    } else {
      msg.textContent = "❌ " + (res && res.error ? res.error : "Erreur");
      btn.disabled = false;
    }
    try { delete window[callbackName]; } catch(e) {}
    try { script.remove(); } catch(e) {}
  };

  const url = API_URL
    + "?vehicle=" + encodeURIComponent(VEHICLE_ID)
    + "&device=" + device
    + "&callback=" + encodeURIComponent(callbackName)
    + "&t=" + Date.now(); // évite cache

  const script = document.createElement("script");
  script.src = url;

  // si le script ne se charge pas du tout
  script.onerror = function() {
    msg.textContent = "❌ Erreur réseau. Réessaie.";
    btn.disabled = false;
    try { delete window[callbackName]; } catch(e) {}
    try { script.remove(); } catch(e) {}
  };

  document.body.appendChild(script);
}
</script>
</body>
</html>
